# Paper A（重寫稿｜繁體中文｜結構型哨兵 × 伴隨協議 × 高壓回歸）

---

## 標題

**超越牛頓極限：以偽瞬態延拓、結構型哨兵與伴隨協議提升高各向異性 Hamiltonian 約束的全局可解性**
（Beyond the Newtonian Limit: Globalizing Solvability in Highly Anisotropic Hamiltonian Constraints via Pseudo-Transient Continuation, Structural Sentinels, and Adjoint Protocols）

---

## 摘要（Abstract）

在數值相對論的初值問題中，為了在有限計算域上處理外域無限遠端與邊界配置，常引入極端座標映射與非均勻網格。此類幾何處理雖能改善外域解析度與邊界一致性，卻也會造成顯著的網格拉伸與強各向異性（high anisotropy），使離散化後的非線性橢圓型約束方程在線性化層面出現嚴重尺度不均衡；其典型後果是 Newton–Krylov 流程在局部區域出現步長崩塌、停滯平台、或全局化失效（可視為一種「信任域縮退／崩塌」表徵）。

本文聚焦於共形平坦初值設定下的 Hamiltonian 約束：
$$
\nabla^2 \psi - \frac{1}{8}\psi R - 2\pi \rho \psi^5 = 0,
$$
並提出一套以「生存—診斷—矯正」為結構的全局求解架構。其核心由三個可分離、可重現的機制構成：

1. **生存層（Survival Base）：** 以偽瞬態延拓（Pseudo-Transient Continuation, PTC）將靜態方程嵌入擬時間動力學，並以幀內重試（In-Frame Retry）與對角尺度預條件（Scale-Adaptive Diagonal Preconditioning）提供 failure absorption，使流程在高拉伸與高非線性下仍可穩定前進。
2. **診斷層（Structural Sentinel）：** 引入以目標函數
   $$
   \phi(\psi)=\frac{1}{2}|F(\psi)|^2
   $$
   為核心的幾何診斷量。透過自動微分獲得精確梯度
   $$
   g=\nabla\phi(\psi)=J(\psi)^T F(\psi),
   $$
   並計算牛頓候選方向 $d_N$ 與 $g$ 的**歸一化餘弦對齊度**：
   $$
   \mathcal{C}_{\rm align}=\frac{\langle g,d_N\rangle}{|g|,|d_N|+\epsilon},
   $$
   用以辨識「幾何逆行（Type-1，上坡）」與「信號消失（Type-2，近正交／盲區）」兩類機制，避免僅以殘差平台或單次拒絕來推測結構失效。
3. **矯正層（Adjoint / Exact-Gradient Fallback）：** 當診斷顯示牛頓方向在目標函數幾何上不可靠或流程進入可辨識的全局化障礙時，切換到與 $\phi$ 一致的回退方向（伴隨方向）以恢復單調推進；其步長設計顯式綁定擬時間步長與殘差尺度，使回退在高壓區域仍保持可解釋性與可控性。

數值實驗採用包含「非對稱雙團塊（Two-Lump）」、「高振幅（強非線性）」與「強拉伸（高各向異性）」的高壓回歸測試，以檢驗協議在極端條件下的穩健性。結果顯示：在強非線性與強拉伸同時存在的設定下，流程可在無人工干預下保持穩定下降並達到高精度收斂；同時，$\mathcal{C}_{\rm align}$ 提供了對方向幾何健康度的可視化證據，使「是否需要回退」由可檢驗的結構量決定，而非依賴經驗性調參。本文因此提出：將全局化從「盲目縮步」轉向「幾何感知與協議分流」，是提升高各向異性 Hamiltonian 約束可解性的關鍵。

---

## 1. 引言（Introduction）

廣義相對論的初值問題（Initial Value Problem）是數值相對論的核心。對於共形平坦（conformally flat）的初值資料，Hamiltonian 約束可化為非線性橢圓型方程：
$$
\nabla^2 \psi - \frac{1}{8}\psi R - 2\pi \rho \psi^5 = 0,
$$
其中 $\psi$ 為共形因子，$\rho$ 為物質源項（示意）。

為在有限計算域上處理物理上的無限遠端，本文採用一類雙曲正弦映射（示意形式）把計算座標 $\xi\in[-1,1]$ 映射到物理座標 $x\in[-L,L]$：
$$
x(\xi)= L,\frac{\sinh(\gamma \xi)}{\sinh(\gamma)}.
$$
此映射在 $\gamma$ 增大時會在域邊界附近產生強拉伸。本文以拉伸率 $\Gamma$ 表徵各向異性強度，採用可檢驗定義：
$$
\Gamma ;:=; \frac{\max_i \Delta x_i}{\min_i \Delta x_i},
\qquad \Delta x_i = x_{i+1}-x_i.
$$

當 $\Gamma$ 進入高值區間時，離散系統常呈現質變式困難：牛頓步長被迫快速縮小、線搜索反覆拒絕、殘差停滯或振盪。在工程語境下，這可視為「信任域縮退／崩塌」：並非單純“慢”，而是局部線性化在強各向異性下失去足夠的有效半徑，導致全局化策略不再可靠。

本文關注的核心問題是：在高各向異性下，如何構造一套**可運行、可診斷、可矯正**的協議，使求解器不必依賴不可重現的人工調參即可跨越平台與障礙，並在可能時恢復牛頓類方法的局部效率。

---

## 2. 方法論（Methodology）

本文以 JAX 實作無矩陣 Newton–Krylov（JFNK）框架，並採用層級化設計，將求解拆解為三個互補角色：生存性底座、結構診斷、以及 merit-aware 的回退矯正。

### 2.1 殘差算子、邊界條件與離散化摘要

令 $F(\psi)$ 表示離散殘差算子（對應 PDE 的離散化）。本文採用與外域一致的邊界條件（無窮遠端 $\psi\to 1$ 的離散等價）：
$$
\psi|_{\partial\Omega}=1.
$$
算子離散可採有限差分或有限體積通量形式；本文僅假設我們可在「無矩陣」架構下提供 Jacobian-vector product $Jv$ 以供 Krylov 內層迭代使用。

---

### 2.2 偽瞬態延拓（Pseudo-Transient Continuation, PTC）

我們將 $F(\psi)=0$ 以擬時間形式重寫為：
$$
\frac{\partial \psi}{\partial \tau} = -F(\psi).
$$
其離散化導致帶對角偏移的線性化系統（概念式）：
$$
\left(J(\psi) + \frac{1}{\Delta \tau} I\right)\delta\psi = -F(\psi),
\qquad \psi \leftarrow \psi + \delta\psi.
$$
$\Delta\tau$ 為擬時間步長。當 $\Delta\tau$ 較小時更新偏保守，提供類阻尼下降的穩定性；當 $\Delta\tau$ 增大時更新趨近牛頓（在可線性化半徑內可帶來更高效率）。本文將 PTC 視為「可解性走廊（solvability corridor）」的工程實現：它提供一條可控路徑，使求解器不必假設全局吸引域的存在。

---

### 2.3 尺度自適應對角預條件（Scale-Adaptive Diagonal Preconditioning）

在高各向異性網格下，Jacobian 的局部尺度可跨越多個數量級，使 Krylov 內層迭代對局部尺度高度敏感。本文採用尺度自適應對角預條件器（概念式）：
$$
M^{-1} r \approx \frac{r}{|{\rm diag}(J)| + \Delta\tau^{-1}},
$$
並以絕對值（或局部下界）處理可能的符號風險，避免預條件器在局部尺度劇烈變化時意外放大更新或引入符號不穩定。此設計的目的在於提升可運行性與可診斷性，而非宣稱無條件保證下降。

---

### 2.4 幀內重試（In-Frame Retry）與雙重容忍接受準則（Dual Tolerance Acceptance）

為避免病態區域中單次失敗造成外層迭代浪費，我們採用幀內重試：若某次更新未能改善目標函數，則在同一外層迭代內縮小 $\Delta\tau$ 並重試，而非等待下一外層迭代。

本文將接受準則建立在目標函數
$$
\phi(\psi)=\frac{1}{2}|F(\psi)|^2
$$
上，並採用**相對＋絕對的雙重容忍**以隔離浮點噪聲與真實惡化。令 $\phi_k=\phi(\psi_k)$、$\phi_k^{\rm trial}=\phi(\psi_k^{\rm trial})$，則接受條件可寫為：
$$
\phi_k^{\rm trial} \le \phi_k (1+r_{\rm tol}) + a_{\rm tol}.
$$
此準則使末端高精度區域不因浮點噪聲自鎖，同時保持整體近單調（near-monotone）的推進行為。

---

### 2.5 結構型哨兵（Structural Sentinel）：歸一化餘弦對齊度

傳統全局化往往以「殘差是否下降」作為唯一判準，但在高各向異性下，平台與失效可能包含多種結構機制，僅憑殘差曲線難以區分。本文引入結構型哨兵：以 $\phi$ 的精確梯度作為幾何基準。

由於
$$
\phi(\psi)=\frac{1}{2}|F(\psi)|^2,
$$
其梯度為
$$
g=\nabla\phi(\psi)=J(\psi)^T F(\psi).
$$
本文以自動微分直接計算 $g$，並令 $d_N$ 為牛頓候選方向（由 PTC-shifted Newton–Krylov 子問題得到）。定義歸一化餘弦對齊度：
$$
\mathcal{C}_{\rm align}=\frac{\langle g,d_N\rangle}{|g|,|d_N|+\epsilon}.
$$

$\mathcal{C}_{\rm align}$ 提供一個尺度無關的幾何診斷量：它描述牛頓候選方向相對於目標函數梯度的“下坡一致性”。直觀上：

* $\mathcal{C}_{\rm align}<0$：$d_N$ 與 $-g$ 具有一致下坡成分（健康下降）。
* $\mathcal{C}_{\rm align}>0$：$d_N$ 在 $\phi$ 幾何上呈上坡傾向（幾何逆行，Type-1）。
* $|\mathcal{C}_{\rm align}|\approx 0$：$d_N$ 與 $g$ 近正交（信號消失／盲區，Type-2），可能對應於狹窄走廊、近平台或接近精度邊界。

本文強調：Type-1 與 Type-2 是不同的結構現象。Type-2 不應被等同於“錯誤方向”；在高精度末端，$|\mathcal{C}_{\rm align}|$ 變小也可能是正常收斂特徵。因此，哨兵的角色不是替代殘差準則，而是提供可檢驗的結構分流訊號，降低“撞牆後才反應”的被動性。

---

### 2.6 進階機制：伴隨協議（Adjoint / Exact-Gradient Fallback）

當流程進入可辨識的全局化障礙（例如：在既定重試尺度下無法獲得可觀測下降，或哨兵顯示牛頓候選方向在 $\phi$ 幾何上不可靠）時，我們引入與 $\phi$ 一致的回退方向。

由於
$$
g=\nabla\phi(\psi)=J(\psi)^T F(\psi),
$$
則
$$
d_G=-g
$$
為 $\phi$ 的一階下降方向（在足夠小步長下可保證 $\phi$ 降低）。本文將其定位為高階矯正機制：它不是替代牛頓，而是在全局化障礙區提供“穿透”路徑，直到流程回到牛頓有效的吸引域／可線性化半徑內，再切回牛頓以恢復效率。

為保持尺度自洽與可控性，回退步長採顯式綁定擬時間步長與殘差尺度的形式（概念式）：
$$
\delta\psi_{\rm adj} = -\alpha,\Delta\tau ,\frac{g}{|g|+\epsilon},|F|.
$$
此設計使回退更新自然隨殘差縮小而縮小，並由 $\Delta\tau$ 控制整體推進速度，避免“步長縮小無效”的協議錯配。

---

## 3. 數值實驗與結果（Numerical Experiments）

本文採用兩類測試目的不同的場景：一類用於觀察高各向異性下的停滯平台與台階式突破（平台診斷場景）；另一類用於驗證協議在高壓高非線性下的穩健性（高壓回歸場景）。本文刻意將重點放在“可重現的結構現象”，而非追求單一基準測試的極限性能。

### 3.1 平台現象與台階式下降（Plateau and Step-Wise Descent）

在高各向異性與多源項場景中，我們可觀測到一類典型行為：殘差下降到某一量級後進入長期平台，牛頓候選方向即使配合深度回溯（$\alpha$ 逐步縮小）也僅能取得極微弱改善；此時若引入 merit-aware 的伴隨回退，殘差可出現台階式下降，並在台階後恢復牛頓步的局部效率。此現象支持：困難不僅來自剛性（stiffness），亦包含“方向／幾何信息不足”導致的全局化障礙。

（註：本文將此類平台視為結構事件；其更細分類可由 $\mathcal{C}_{\rm align}$ 與回溯步長統計共同提供。）

---

### 3.2 高壓回歸測試（High-Pressure Regression）：非對稱雙團塊 × 強非線性 × 強拉伸

為檢驗協議在極端條件下的穩健性，我們設計高壓回歸測試：

* **源項形狀：** 非對稱雙團塊（Two-Lump）高斯分佈，以破壞對稱性並製造複雜勢阱。
* **強非線性：** 將 $\rho$ 的振幅提升至高值區間，使源項反應強烈。
* **強拉伸：** 使用較大的映射參數以增加各向異性，使計算域存在狹窄的可解性走廊。

在此場景中，殘差初值可達高量級（例如 $\sim 10^2$），但在 PTC-NK 生存底座與雙重容忍接受準則保護下，流程可保持穩定下降並達到高精度收斂；同時，$\mathcal{C}_{\rm align}$ 在整段過程中維持負值區間，提供牛頓候選方向在目標函數幾何上的健康證據，顯示哨兵不會在高壓條件下誤報、也不會引發末端自鎖。

此結果提供一個重要實務結論：在極端源項與拉伸下，若協議層（接受準則、步長耦合與結構監測）設計正確，牛頓流程可在相當寬的條件下維持方向一致性；而哨兵指標則提供了對“是否已進入危險區”之可視化監督工具，使後續擴展（例如更極端映射、更複雜源項）能以可檢驗方式進行。

---

## 4. 討論（Discussion）

### 4.1 從「盲目縮步」到「幾何感知」

傳統求解器在失敗時常採取的策略是縮小步長（damping / backtracking）。本文指出：在高各向異性下，困難未必等同於“步長不足”，而可能是“方向信息不足”或“幾何一致性破裂”。結構型哨兵提供一個低成本但可檢驗的診斷視角：它不以結果事後推測，而以幾何量直接監測牛頓候選方向相對於目標函數梯度的關係。

### 4.2 回退機制的角色：矯正而非取代

伴隨回退並非旨在取代牛頓，而是提供一條在障礙區可解釋的“穿透路徑”。其價值在於：一旦流程回到牛頓有效的可線性化半徑內，牛頓仍能提供更快的局部效率。此種「快速模式＋矯正模式」的分工，使整體策略兼具效率與穩健。

### 4.3 可遷移性與限制

雖然本文以 Hamiltonian 約束為背景，但其協議層思想（PTC 生存底座、幾何哨兵、merit-aware 回退與雙重容忍接受準則）可視為針對一類非線性橢圓系統的通用設計語彙。當幾何拉伸或係數異質性導致類似全局化障礙時，該框架可能具有跨領域啟發性。然而，不同 PDE 類別與離散方式下，$\mathcal{C}_{\rm align}$ 的統計分佈、平台機制的主導成因、以及回退觸發條件的有效區間仍需在具體問題上再驗證；本文將哨兵視為一個可測量的診斷層，而非宣稱對所有問題給出無條件保證。

---

## 5. 結論（Conclusion）

本文針對高各向異性 Hamiltonian 約束提出一套層級化全局求解架構，並得到以下結論：

1. **生存層（PTC + 幀內重試 + 對角尺度預條件）：** 可在高拉伸與強非線性條件下維持可運行性，提供 failure absorption 與可診斷推進路徑。
2. **診斷層（結構型哨兵）：** 以 $\phi=\frac12|F|^2$ 的精確梯度資訊定義歸一化餘弦對齊度 $\mathcal{C}_{\rm align}$，提供牛頓候選方向幾何健康度的可檢驗量，並支持對「幾何逆行」與「信號消失」等不同機制的分流理解。
3. **矯正層（伴隨回退）：** 在全局化障礙區，採用與目標函數一致的回退方向 $d_G=-J^T F$，並以顯式步長耦合維持尺度自洽與可控性，可促成平台後續下降並在合適條件下恢復牛頓效率。
4. **高壓回歸驗證：** 在非對稱雙團塊、強非線性與強拉伸的極端測試中，上述協議可在無人工干預下保持穩定下降並達到高精度收斂；結構哨兵在該測試下提供一致的方向健康證據，且未觀測到由浮點噪聲導致的自鎖。


---
