
---

# Paper A（完整稿｜繁體中文｜結構型哨兵 × 偽瞬態 × 伴隨回退）

## 標題

**超越牛頓全局化瓶頸：以偽瞬態延拓、結構型哨兵與伴隨梯度回退求解高各向異性 Hamiltonian 約束**
（Beyond Newton Globalization Barriers: Solving Highly Anisotropic Hamiltonian Constraints via Pseudo-Transient Continuation, Structural Sentinels, and Adjoint-Gradient Fallback）

---

## 摘要（Abstract）

在數值相對論的初值問題中，為處理外域無限遠端與邊界配置，常引入座標映射以將無限域壓縮至有限計算區間。然而，此類映射在邊界附近會造成顯著網格拉伸與度量各向異性（metric anisotropy），使離散化後的非線性橢圓型約束方程呈現強烈尺度不均衡與病態譜結構。其數值後果通常表現為：Newton–Krylov 類方法的步長快速縮退、線搜索反覆拒絕、殘差長平台（residual plateau）、或收斂表現高度依賴細節設定而欠缺可診斷性。這些現象可被理解為一種「全局化障礙（globalization barrier）」：即便線性子問題被精確求解，所得到的牛頓更新仍可能在所選 merit function 下失去可用下降性，導致以傳統線搜索／阻尼為核心的全局化策略難以穩健推進。

本文以共形平坦初值設定下的 Hamiltonian 約束為原型模型：
$$
\nabla^2 \psi - \frac{1}{8}\psi R - 2\pi \rho \psi^5 = 0,
$$
提出一個以「生存—診斷—矯正」為結構的全局求解框架。第一層以**偽瞬態延拓（Pseudo-Transient Continuation, PTC）**提供可運行的生存底座，使求解器在病態譜區仍能透過對角偏移維持線性子問題的可處理性。第二層引入一個**結構型哨兵（Structural Sentinel）**，以 merit function
$$
\phi(\psi)=\frac12|F(\psi)|^2
$$
的精確梯度 $g=\nabla\phi(\psi)=J(\psi)^T F(\psi)$ 與牛頓候選方向 $d_N$ 的**歸一化餘弦對齊度（cosine alignment）**
$$
c(\psi)=\frac{\langle g,d_N\rangle}{|g|,|d_N|+\varepsilon}
$$
作為幾何診斷指標，用於識別「方向逆行」與「信號消失」等結構狀態。第三層在必要時啟用**伴隨梯度回退（Adjoint-Gradient Fallback）**：直接沿 $-g$ 的方向構造更新，並將步長與偽時間步長及殘差尺度顯式耦合，以在局部全局化受阻時提供可驗證的下降推進。最後，我們使用**雙重容忍接受準則（dual tolerance acceptance）**處理浮點噪聲與高精度末端的自鎖風險，使流程在高精度區域仍保持可解釋的單調推進。

數值實驗採用兩類測試族：一類為相對良態的單團塊分布，以驗證哨兵不干擾牛頓效率；另一類為非對稱雙團塊、較強拉伸與較高振幅的高壓測試，用以檢驗協議在強非線性與幾何畸變下的穩健性。實驗結果顯示：在所考察的設定中，PTC 生存底座與雙重容忍接受準則可穩定推進殘差下降；哨兵指標在整個收斂過程中提供一致的幾何可解釋性（例如對齊度長期維持為負，表徵牛頓方向與 merit 梯度一致）；在高壓測試中亦能保持穩定收斂並避免末端自鎖。本文的貢獻在於：將「全局化困難」從一組難以統一的工程現象，轉化為可觀測、可對齊、可回退的協議化結構，為高各向異性 Hamiltonian 約束求解提供一個最小而可擴展的框架。

---

## 1. 引言（Introduction）

### 1.1 背景與挑戰

廣義相對論初值問題（initial value problem）在數值相對論中扮演核心角色。對共形平坦（conformally flat）或近似共形平坦的初值資料，Hamiltonian 約束常被化為非線性橢圓型方程，其基本形式可寫為
$$
\nabla^2 \psi - \frac{1}{8}\psi R - 2\pi \rho \psi^5 = 0,
$$
其中 $\psi$ 為共形因子，$R$ 為三維標量曲率（在常見的共形平坦模型中可取 $R=0$），$\rho$ 為物質源項。

在外域問題（如黑洞或多體系統的外部空間）中，有限計算域對無限遠端的替代通常依賴座標映射。典型地，我們以一維示意映射說明：
$$
x(\xi)=L,\frac{\sinh(\gamma\xi)}{\sinh(\gamma)},\qquad \xi\in[-1,1],;x\in[-L,L].
$$
當 $\gamma$ 增大時，邊界附近產生強拉伸；由此引入的網格各向異性可用拉伸率 $\Gamma$ 描述：
$$
\Gamma := \frac{\max_i \Delta x_i}{\min_i \Delta x_i},\qquad \Delta x_i=x_{i+1}-x_i.
$$
在 $\Gamma\gg 1$ 的情況下，離散系統的局部尺度相差可達多個數量級，使 Jacobian 的條件數與譜性質顯著惡化。此時，傳統 Newton–Krylov 流程常面臨兩類問題：

1. **線性化有效半徑收縮：** 牛頓更新過於激進，線搜索必須將步長反覆縮小才能維持穩定。
2. **全局化障礙：** 即使線性子問題被高精度求解，牛頓方向仍可能難以在所選 merit 下提供可用下降，導致殘差長平台或振盪。

上述困難不僅是“變慢”，更是求解過程可解釋性與可控性的喪失：僅靠調參或單一全局化技巧往往難以穩定解釋「何時會停滯、為何停滯、如何可靠突破」。

### 1.2 研究目標與貢獻

本文目標不是提出一個特定版本的求解器實作，而是提出一個可被檢驗的**協議化框架（protocolized framework）**，其核心思想是：

* 以 PTC 作為「可解性走廊」的生存底座；
* 以結構型哨兵提供「方向是否誠實」的幾何診斷量；
* 以伴隨梯度回退作為可驗證的突破機制；
* 以雙重容忍接受準則避免高精度末端自鎖並保持可解釋性。

本文的主要貢獻可以概括為：將高各向異性下的全局化困難，轉換為一套可觀測、可分流、可回退的機制組合，並在兩類測試族中展示其穩健推進特性。

---

## 2. 方法論（Methodology）

### 2.1 無矩陣 Newton–Krylov 與殘差算子

令 $F(\psi)$ 表示離散殘差算子。本文採用 Dirichlet 外域等價邊界
$$
\psi|_{\partial\Omega}=1,
$$
並使用「無矩陣」方式提供 $Jv$ 的算子乘積以支援 Krylov 內層迭代，其中 $J(\psi)$ 為 $F$ 的 Jacobian。本文關注的是全局化協議與診斷機制，因此離散細節（有限差分或有限體積形式）可視為等價的可替換模組；關鍵是：在高拉伸幾何下，$J$ 的譜性質與尺度不均衡會對求解穩健性造成主導影響。

### 2.2 偽瞬態延拓（Pseudo-Transient Continuation, PTC）

PTC 將靜態方程 $F(\psi)=0$ 轉寫為擬時間演化：
$$
\frac{\partial \psi}{\partial \tau}=-F(\psi).
$$
以半隱式線性化離散後，得到更新方程：
$$
\left(J(\psi)+\frac{1}{\Delta\tau}I\right)\delta\psi=-F(\psi),\qquad \psi\leftarrow \psi+\delta\psi.
$$
其中 $\Delta\tau$ 既可理解為偽時間步長，也可視為對 Jacobian 的對角偏移強度：當 $\Delta\tau$ 較小時，偏移項 $\Delta\tau^{-1}I$ 較大，更新更保守且更接近阻尼下降；當 $\Delta\tau$ 增大時，流程逐步逼近純牛頓更新，提高局部效率。

### 2.3 雙重容忍接受準則（Dual Tolerance Acceptance）

在高精度末端或殘差極小區域，浮點噪聲可能使「嚴格單調下降」判斷失真。本文採用雙重容忍準則對 merit 值 $\phi$ 做接受判斷：
$$
\phi(\psi_{new}) \le \phi(\psi_{old})(1+\mathrm{rtol})+\mathrm{atol},
$$
其中 $\mathrm{rtol}$ 與 $\mathrm{atol}$ 分別控制相對與絕對容忍，以避免因機器精度噪聲而造成流程自鎖或無意義的拒絕。

### 2.4 結構型哨兵（Structural Sentinel）

令 merit function 為
$$
\phi(\psi)=\frac12|F(\psi)|^2.
$$
其精確梯度為
$$
g=\nabla\phi(\psi)=J(\psi)^T F(\psi),
$$
可透過自動微分直接計算（不需手推伴隨方程）。

令 $d_N$ 為 PTC-Newton 內層得到的牛頓候選更新方向（或其等價變形），本文定義歸一化餘弦對齊度：
$$
c(\psi)=\frac{\langle g,d_N\rangle}{|g|,|d_N|+\varepsilon}.
$$
由於 $c\in[-1,1]$ 且為無量綱量，此指標具有良好的可比較性：它不依賴殘差尺度或網格維度的絕對量級，適合作為跨場景的結構診斷量。直觀上：

* $c<0$：$d_N$ 與 $g$ 呈負相關，對應於沿 $d_N$ 推進可使 $\phi$ 一階下降（健康下降區）。
* $c>0$：$d_N$ 與 $g$ 同向，意味著牛頓候選方向在 merit 上呈上坡趨勢（方向逆行風險）。
* $|c|\approx 0$：方向與梯度近正交，表示方向信息不足或落入數值盲區（信號消失）。此情形可能出現在平坦谷地、極高精度末端或特定走廊結構中。

本文將此哨兵定位為**診斷與分流工具**：在健康下降區保留牛頓效率；在方向逆行風險出現時提供可觀測的結構訊號，並觸發回退機制。

### 2.5 伴隨梯度回退（Adjoint-Gradient Fallback）

當哨兵判定牛頓候選方向存在逆行風險，或當外顯症狀（如殘差平台、步長縮退）顯示全局化受阻時，本文使用 $-g$ 作為回退方向：
$$
d_G=-g.
$$
為使回退步長與 PTC 框架一致並避免協議層不一致造成的自鎖風險，本文採用一個顯式綁定偽時間步長與殘差尺度的標準化更新形式：
$$
\delta\psi_G = \alpha,\Delta\tau,\frac{-g}{|g|+\varepsilon},|F(\psi)|,
$$
其中 $\alpha$ 為常數係數（可視為保守度參數）。此設計使回退步長在遠離解（殘差大）時具足夠推進力，在接近解（殘差小）時自然縮小，並與 PTC 的偽時間尺度保持一致。

---

## 3. 數值實驗（Numerical Experiments）

本文採用兩類測試族以分別驗證：（i）健康情況下哨兵不干擾牛頓效率；（ii）在強非線性與強拉伸下流程仍能穩健推進並保持可解釋性。

### 3.1 測試族 I：相對良態的單團塊分布

此測試使用較平滑、近對稱的單團塊密度分布作為 $\rho$，並採用中等拉伸設定。其目的不是“逼出失效”，而是檢驗：

* 流程是否能以 PTC-Newton 主導快速下降；
* 哨兵指標在收斂過程中是否提供穩定且一致的幾何訊號（例如長期維持 $c<0$）；
* 雙重容忍是否能避免高精度末端的自鎖。

### 3.2 測試族 II：非對稱雙團塊 × 高振幅 × 強拉伸（高壓回歸測試）

此測試採用兩個非對稱的高斯團塊（Two-Lump），其位置、寬度與幅度不同，以破壞對稱性並形成更複雜的勢阱結構；同時提高源項幅度並加強座標拉伸，以形成更強的非線性與幾何畸變。此測試的目的在於檢驗：

* PTC 生存底座與雙重容忍準則在高殘差尺度下仍能穩定推進；
* 哨兵指標在高壓場景中是否仍提供一致的可解釋訊號（例如 $c$ 仍呈負值表示方向一致）；
* 流程是否能避免末端自鎖並達到嚴格收斂門檻。

---

## 4. 結果與觀察（Results and Observations）

### 4.1 良態測試：哨兵不干擾牛頓效率

在良態測試中，殘差可在有限迭代內單調下降至收斂門檻；哨兵指標在整個過程中提供穩定的負對齊度（$c<0$），表徵牛頓候選更新與 merit 梯度的幾何一致性。雙重容忍準則避免了在極小殘差區域因浮點噪聲造成的拒絕—重試—自鎖循環，使流程在高精度末端保持可解釋的終止行為。

### 4.2 高壓回歸測試：強非線性與強拉伸下的穩健推進

在非對稱雙團塊、高振幅與強拉伸的高壓測試中，殘差從高初值開始迅速下降並在有限迭代內達到收斂門檻。值得注意的是，哨兵指標在該測試中仍維持為負值區間，顯示即使在所考察的高壓設定下，牛頓候選方向仍保持與 merit 梯度一致的下降幾何結構；同時，流程未觀察到高精度末端的自鎖現象，顯示雙重容忍準則與步長耦合協議在此尺度下仍保持穩健。

> 註：上述結果不意味著所有高壓場景必然觸發方向逆行或信號消失。相反地，這提供了一個可被檢驗的事實：在所採用的高壓設定中，哨兵指標並未顯示方向逆行訊號，且流程以牛頓主導完成收斂。

---

## 5. 討論（Discussion）

### 5.1 從“試錯”到“可觀測協議”

傳統全局化策略常依賴線搜索或阻尼規則，在高各向異性下容易演化為“以步長縮小解決一切”的試錯過程。本文提出的框架以 PTC 提供生存底座，並引入可觀測的哨兵指標將“方向是否誠實”轉化為幾何量；同時，伴隨梯度回退提供一條可驗證的一階下降路徑，使突破平台或逆行風險不再完全依賴經驗性調參。

### 5.2 哨兵的角色：監測器而非干預器

本文的實驗顯示：在多個測試族中，哨兵多數時間僅作為監測器提供結構訊號，而不必然介入。這一點具有方法論意義：哨兵的價值不在於“必定觸發救援”，而在於提供一個跨場景可比較的結構座標，使我們能在需要時以一致語言描述「逆行」「信號消失」「健康下降」等狀態，並在未來擴展更完整的 failure taxonomy 與回退家族（rescue family）。

---

## 6. 結論（Conclusion）

本文針對高各向異性 Hamiltonian 約束提出一個以「生存—診斷—矯正」為核心的全局求解協議。其要點為：

1. **PTC 生存底座：** 透過對角偏移形成可解性走廊，使流程在病態譜區仍能穩定推進。
2. **結構型哨兵：** 以歸一化餘弦對齊度 $c$ 提供跨場景可比較的幾何診斷量，用於監測方向一致性與潛在風險狀態。
3. **伴隨梯度回退：** 在必要時沿 $-J^T F$ 的 merit-aware 方向推進，並將步長與偽時間尺度及殘差尺度一致化，以提供可驗證的下降機制。
4. **雙重容忍接受準則：** 在高精度末端避免自鎖並維持可解釋的單調推進。

在本文所考察的良態與高壓測試族中，該協議展現穩健收斂與一致的幾何可解釋性。更重要的是，此工作提供一個去耦合於具體實作版本的可檢驗框架：核心概念是可觀測量（$c$）與協議化分流，而非特定版本的工程細節。未來工作可在此框架上擴展更完整的失效分類學與回退家族，以覆蓋更極端或更接近真實數值相對論初值生成的設定。

---

## （可選）附錄建議：實驗日誌字段（便於審稿與復現）

建議在補充材料中固定輸出至少以下字段：
`res_norm`, `merit`, `dt`, `cos_align`, `step_type`（NEWTON/SNIPER）, `accepted/rejected`。
其目的在於將“穩健性”從敘事轉換為可審稿的可觀測序列。

---


