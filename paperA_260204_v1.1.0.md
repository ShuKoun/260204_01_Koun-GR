



---

## 標題

**Beyond the Newtonian Limit: Globalizing Solvability in Highly Anisotropic Hamiltonian Constraints via Pseudo-Transient Continuation and Adjoint Protocols**
**（超越牛頓極限：通過偽瞬態延拓與伴隨協議實現高各向異性 Hamiltonian 約束的全局可解性）**

---

## 摘要（Abstract）

在數值相對論的初值問題中，極端坐標變換（如雙曲正弦映射）雖然解決了幾何拓撲問題，卻引入了強各向異性（High Anisotropy），導致橢圓型約束方程的 Jacobian 矩陣條件數呈指數級惡化。本文報告了兩個關鍵發現：第一，當各向異性超過特定閾值時，標準的牛頓-克雷洛夫方法會遭遇「信任域崩塌」；第二，在特定的殘差平台區（Plateau），牛頓方向不再是殘差範數的有效下降方向。

為此，我們提出了一種層級化的全局求解架構。基礎層利用**偽瞬態延拓（PTC）**與**幀內重試（In-Frame Retry）**確保求解器的生存性（Robustness）；而在陷入僵局的極限區域，我們引入了基於 JAX 自動微分的**伴隨梯度協議（Adjoint Gradient Protocol）**。該協議利用精確的 $J^T F$ 方向穿透牛頓法的失效區。數值實驗表明，該架構不僅能在極端拉伸網格上倖存，更能突破殘差平台，為高精度黑洞模擬提供了一個最小可行的數值框架。

---

## 1. 引言（Introduction）

廣義相對論的初值問題（Initial Value Problem）是數值相對論的基石。對於共形平坦的初值數據，問題簡化為求解非線性的 Hamiltonian 約束方程：

$$
\nabla^2 \psi - \frac{1}{8}\psi R - 2\pi \rho \psi^5 = 0
$$

其中 $\psi$ 是共形因子。為了處理物理上的無限區域，Koun-U 變換被廣泛使用，但在物理邊界附近引入了極大的網格拉伸率（Stretching Factor, $\Gamma$）。

當 $\Gamma$ 進入極端區間（例如 $\Gamma \ge 15$），問題發生質變：

1. **線性化失效：** 標準牛頓步長給出的修正量遠超物理信任域。
2. **方向迷失：** 即使線性子問題求解精確，牛頓方向也可能與全局殘差範數的下降方向正交。

本文挑戰了僅靠預條件器就能解決此問題的傳統觀點，提出了一種將靜態邊值問題轉化為擬時間演化問題的方案，並引入了基於現代微分編程（Differentiable Programming）的伴隨機制來處理極端非線性。

---

## 2. 方法論（Methodology）

我們構建了一個基於 JAX 的無矩陣牛頓-克雷洛夫求解器（JFNK）。為了平衡效率與穩健性，我們採用了一種層級化的設計哲學。

### 2.1 求解器的層級架構（A Hierarchical Solver Suite）

KOUN-GR 架構提供了一套針對不同物理情境的分層解決方案：

* **Level 0：固定網格牛頓求解器（Fixed-Grid）。** 適用於弱引力場。利用 FFT 或多重網格加速，極致高效。
* **Level 1：變網格牛頓求解器（Variable-Grid）。** 適用於一般非線性問題。結合了坐標變換的幾何優勢，但保留了經典牛頓法的速度。
* **Level 2：偽瞬態相對論求解器（PTC-GR Solver）。** **這是本文的核心。** 專為強引力場及高各向異性區域設計，犧牲部分速度以換取絕對的穩健性。

以下小節詳述 Level 2 求解器的關鍵機制。

---

### 2.2 偽瞬態延拓（Pseudo-Transient Continuation）

我們將原問題轉化為時間演化方程：

$$
\frac{\partial \psi}{\partial \tau} = -F(\psi)
$$

離散化後，這等價於對 Jacobian 矩陣的對角線進行動態增強：

$$
\left(J + \frac{1}{\Delta \tau} I\right)\delta\psi = -F(\psi)
$$

通過動態調整 $\Delta \tau$（SER 策略），我們在初期利用小步長的穩定性（類最速下降），在後期恢復大步長的收斂性（類牛頓法）。

---

### 2.3 幀內重試與嚴格單調性（In-Frame Retry）

為了消除數值漂移，我們實施了**「幀內重試」**機制：若當前步長導致殘差上升，我們不進入下一幀，而是立即在當前幀縮小 $\Delta \tau$ 並重新求解線性系統。這保證了求解路徑的**嚴格單調下降**。這在我們的開發版本 v1.3.22 中被證實是確保算法「生存（Survival）」的關鍵。

---

### 2.4 進階機制：伴隨協議（The Adjoint Protocol）

*注：本節描述的機制用於解決 PTC 在極端平台區（Plateau）的停滯問題，是 v1.3.29 引入的高級特性。*

在 $\Gamma = 15$ 的極端條件下，我們觀察到一種特殊的失效模式：即便是精確求解的牛頓方向 $dx_{\text{Newton}}$，也無法使殘差範數 $|F|$ 下降（BestRatio $\approx 1.0$）。這意味著牛頓法遭遇到全局化障礙（Globalization Barrier）。

為了突破此障礙，我們引入 **伴隨梯度回退（Adjoint Gradient Fallback）**。

定義目標函數（Merit Function）：

$$
\phi(\psi) = \frac{1}{2}|F(\psi)|^2
$$

利用 JAX 的自動微分（AD）能力，我們可以直接計算其精確梯度：

$$
g = \nabla \phi = J^T F
$$

當檢測到牛頓方向失效時，求解器會自動切換至 $dx = -g$。數學上，這保證了它是 $\phi$ 的下降方向。這使我們能夠穿透牛頓法無法處理的平台區，待進入收斂半徑後再切回牛頓法。

---

## 3. 數值實驗與結果（Numerical Experiments）

### 3.1 基礎收斂性（Survival Proof）

在 $32^3$ 網格、$\Gamma=15$ 的基準測試中，我們對比了不同策略：

* **Naive Newton：** 立即發散。
* **Robust PTC（v1.3.22）：** 成功生存。如下圖所示（*此處插入殘差收斂圖*），算法通過動態調整 $\Delta \tau$ 避免崩潰，但在殘差 $10^{-1}$ 處進入長期的平台期。這證明了 PTC 機制能保證「不死」，但不足以「高精」。

---

### 3.2 診斷與突破（The Breakthrough）

為了分析 $10^{-1}$ 平台，我們進行了深入診斷（基於 v1.3.26–v1.3.29 的實驗數據）：

1. **方向失效驗證：** 實驗顯示，在平台區，即使將線搜索步長 $\alpha$ 縮小至 $1/64$，牛頓方向的殘差下降比率（BestRatio）仍鎖定在 $1.000000$。這證偽了「網格誤差底板」的猜想，證實了是方向選擇錯誤。
2. **直覺方法的失敗：** 我們嘗試了預條件殘差方向 $dx=M^{-1}F$ 作為回退，結果導致殘差漂移而非下降（v1.3.28）。
3. **伴隨梯度的成功：** 啟用 Adjoint Protocol 後，系統在檢測到牛頓停滯時自動切換至 $-J^T F$ 方向。日誌顯示，殘差呈現出台階式下降，成功穿透平台，最終恢復收斂。

這一系列實驗揭示了高各向異性問題的本質：它不僅是剛性（Stiff）的，更是具有欺騙性的局部極小結構，必須依賴物理上正確的梯度信息（$J^T F$）才能導航。

---

## 4. 討論（Discussion）

### 4.1 跨領域的通用性（Cross-Disciplinary Generalizability）

儘管本文以 Hamiltonian 約束為背景，但 PTC-NK 架構本質上是對一類通用非線性橢圓型 PDE 的求解方案：

$$
\nabla \cdot (A(\psi)\nabla \psi) + f(\psi) = 0
$$

這種形式廣泛存在於其他領域，例如：

* **靜電學：** 處理尖端放電或非線性介電材料時的 Poisson–Boltzmann 方程。
* **流體力學：** 不可壓縮流體在複雜動邊界下的壓力泊松方程。

我們的自適應預條件與伴隨協議，可直接遷移用於解決這些領域中因幾何拉伸導致的數值不穩定性。

---

## 5. 結論（Conclusion）

本文通過對 Koun-GR 架構的演進分析，得出以下結論：

1. **生存優先：** 偽瞬態延拓（PTC）與幀內重試是確保極端幾何下算法不崩潰的必要條件。
2. **數學正統性：** 在牛頓法失效的殘差平台區，基於自動微分的精確伴隨梯度（$-J^T F$）是唯一可靠的突破手段。

這套架構將傳統數值相對論的開發週期從數月（手推伴隨方程）壓縮至數小時（JAX 自動微分），為下一代高精度黑洞模擬奠定了方法論基礎。

---

